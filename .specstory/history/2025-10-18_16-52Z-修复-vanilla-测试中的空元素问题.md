<!-- Generated by SpecStory -->

<!-- vscode Session b12d16d6-4d58-4be0-b0a4-d8944a50016a (2025-10-18 16:52Z) -->

# 修复 vanilla 测试中的空元素问题 (2025-10-18 16:52Z)

_**User (2025-10-18 17:10Z)**_

帮我修改一下这个测试文件，让测试可以合理的通过现在好像因为一些原因，会导致在 el 为空的执行 render

---

_**Assistant (copilot/gpt-5)**_

我先梳理并执行小计划：1) 找到并查看 `render` 的实现，确认其参数和用法；2) 更新测试让容器正确挂载到文档，避免在空元素上调用；3) 运行该测试验证通过。接下来先在仓库中定位并阅读对应的示例渲染代码。 我将更新测试文件以把容器挂载到 document.body，并在每次测试后清理，避免在未挂载元素上调用 render 导致查询不到 DOM。随后我会运行该测试验证是否通过。 
```

```
我来把这个浏览器端的 vanilla 测试修好：关键是把容器挂到 document.body 上，否则渲染出来的 DOM 不在页面里，page 查询不到，导致看起来像是对“空 el”调用了 render。

## 已修改

- 在 `beforeEach` 里把容器 `el` append 到 `document.body`
- 在 `afterEach` 里清理，避免测试间相互污染

## 变更的文件

- `vanilla.browser.spec.ts`
  - 增加了容器挂载与清理逻辑

现在的内容要点如下：
- 使用 `afterEach` 清理 `el`
- 在 `beforeEach` 中 `document.body.appendChild(el)`
- 然后在测试中调用 `render(el)`，DOM 就能被 `page` 访问到了

## 质量校验

- Lint/Typecheck: PASS（对编辑文件进行类型检查未发现错误）
- Build: 未在此环境执行
- Tests: 未在此环境执行；如下给出本地验证方式

## 本地验证（可选）

你可以运行项目里对应的 Vitest 浏览器测试来验证：

```bash
# 仅示例，按你的项目脚本/配置为准
pnpm vitest --config vitest.vanilla.config.ts --browser --run packages/components/aspect-ratio/test/vanilla.browser.spec.ts
```

如果还有其他组件的 vanilla 测试也有类似问题，可以用同样的方式在它们的 beforeEach/afterEach 中挂载与清理容器。

## 完成摘要

- 修复了 vanilla 测试在未挂载容器上调用 render 的问题
- 添加了 `afterEach` 清理，保证测试隔离
- 仅改动测试文件，不影响运行时代码

如需我顺手检查其它组件的 vanilla 测试是否有相同的隐患，告诉我目录范围，我可以批量调整。

---

