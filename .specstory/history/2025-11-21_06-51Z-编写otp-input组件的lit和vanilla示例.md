<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- vscode Session 61d620a4-7fc8-4dd0-9ece-168c32c81cc4 (2025-11-21 06:51Z) -->

# 编写otp-input组件的Lit和Vanilla示例 (2025-11-21 06:51Z)

_**User (2025-11-21 06:56Z)**_

我想你根据 #packages/components/combobox 和 #packages/components/color-picker 的 lit 和 vanilla 的 example 来帮我编写一下 #packages/components/otp-input 的 examples 中的 lit 和 vanilla 的例子.你可以看看 #packages/components/otp-input 中的 [react](packages/components/otp-input/examples/react/OtpInput.react.tsx) 和 [solid](packages/components/otp-input/examples/solid/OtpInput.solid.tsx), [vue](packages/components/otp-input/examples/vue/OtpInput.vue), [svelte](packages/components/otp-input/examples/svelte/OtpInput.svelte) ,同时别忘了在 storybook 中注册哦

---

_**Agent (model copilot/gpt-5.1-codex)**_

**Planning example components setup****Seeking internal examples****Planning directory additions****Inspecting lit file****Requesting more input****Finding example file****Checking package structure for OTP****Identifying lit and vanilla examples****Preparing example structure and styles****Locating storybook for OTP input****Checking Storybook setup****Identifying story entry pattern****Noting simple context****Preparing to create OTP examples****Examining OTP input styling and controls****Organizing tasks for lit component creation****Marking task in progress****Implementing Lit example with machine integration**

I'm building a Lit example for the OTP input component, focusing on wiring up the machine controller, controls, and event handlers properly. I'll create the necessary files with appropriate imports, use arrow functions for event handlers to keep context, and ensure that styles and hidden inputs are included just like in other components. I'll start by making the TypeScript file that defines the Lit element, then the Astro example file, trusting create_file to handle directory creation.**Verifying component imports and styling****Confirming completion of todo 1****Marking next todo as in progress****Preparing to create simple vanilla example****Planning OTP input component**

I’m examining how to build a simpler OTP input version inspired by a vanilla example, focusing on hooking the component to the DOM and managing props with `otpInput.connect`. I’m considering whether the `Component` class generic needs a `MachineState` type like the combobox example and planning to check OTP’s types to confirm. This will help me shape the example class and its state management properly.**Identifying missing types file****Checking state and context types****Verifying state type usage and exports****Examining type exports and machine.ts****Checking type exports and generics****Reviewing type imports and service initialization****Checking argument requirements****Searching for Service type export****Designing OTP input component structure**

I’m outlining a TypeScript component for OTP input, inspired by a checkbox example, setting up DOM structure and event handling with spreadProps. I plan to define element queries, manage clear button click events to reset input, and ensure integration with StateVisualizer by importing relevant state types. I’m also preparing a render function to create the layout and instantiate the component, all typed carefully. Next, I’ll implement this in a new example file.**Identifying need for Astro file****Verifying CSS data-scope attribute****Adding Storybook entries for new frameworks****Switching to vanilla story****Updating task status****Marking task as completed****Preparing final summary and response**

I'll highlight the added example files for lit and vanilla in the components package, note the new Storybook entries with their controls hooking, mention that no tests were run, and suggest running Storybook with `pnpm storybook` to verify the updates—all framed with clear file path references and next steps.- Added Lit demo (`OtpInput.ts`, `OtpInput.astro`) mirroring other framework samples: wires `MachineController` + shared controls, renders three inputs plus hidden field, and exposes a clear button with toolbar + state visualizer for parity with React/Solid implementations.
- Added Vanilla demo (`OtpInput.ts`, `OtpInput.astro`) using the shared `Component` helper; it spreads props onto a simple DOM scaffold, hooks the clear button into the API, and keeps the toolbar/state visualizer in sync with control panel changes so behavior matches other stacks.
- Registered the new demos in Storybook via `lit.stories.ts` and `vanilla.stories.ts` so they appear alongside the existing framework stories.

No automated tests were run (examples + story definitions only). Next step: run Storybook (`pnpm --filter storybook dev` or your usual command) to verify the new Lit and Vanilla stories render as expected.

---

_**User (2025-11-21 06:59Z)**_

这个也出现了一个问题,我们的 输入框中被加上了 readonly 的标识,导致无法输入,你应该在 connection 中增加判断,你可以看看 color-picker 是怎么做的

---

_**Agent (model copilot/gpt-5.1-codex)**_

**Checking OTP input connection module****Investigating readonly attribute issue****Investigating readOnly attribute source****Fixing conditional readOnly attribute**
```

```
**Summarizing minor updates and testing status**- Updated `connect.ts` so the `readOnly` attribute is only added when the component is actually configured as read-only, matching the color-picker pattern. This prevents browsers from forcing the OTP inputs into read-only mode when `readOnly` is falsey while preserving the attribute for true cases.

No tests were executed (connect-layer tweak only). Consider running the relevant Storybook stories or framework demos to confirm the inputs now accept typing normally.

---

_**User (2025-11-21 07:02Z)**_

但是我发现 lit 还是无法输入,同时我在 vanilla 的例子中第一次输入的时候他是没有办法自己跳到第二个的,我输入了第一个他不会跳到第一个,但是我如果都输入过了,然后在清空,他就会自己跳到下一个了.这也需要修复一下

---

_**Agent (model copilot/gpt-5.1-codex)**_

**Investigating read-only input in Lit components****Investigating rerender impact on input reset****Considering searching for packages****Analyzing Lit input initialization issues**

I'm exploring why the readOnly attribute issue persists in the lit example despite removing it conditionally, suspecting the DOM inputs might not exist when the machine's setupValue action runs. This could cause the machine to see zero input elements initially and set empty values, affecting input length and behavior, so I want to check how otpInputControls handles initial values or state context to understand the proper initialization flow.**Analyzing initial input focus issue****Verifying input element count**

---

