<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- vscode Session 24a0a975-bc18-4caa-a8a5-7729cc9b78f9 (2025-11-25 00:37Z) -->

# Dynamic component tests cleanup implementation (2025-11-25 00:37Z)

_**User (2025-11-25 00:51Z)**_

帮我给 dynamic 的测试也加上 cleanup 吧

---

_**Agent (model copilot/gpt-5.1-codex)**_

**Considering adding cleanup in dynamic tests****Considering adding cleanup to render****Assessing cleanup in dynamic render****Preparing to make a call****Investigating dynamic test cleanup****Implementing cleanup for dynamic example and tests**

I'm updating the dynamic example so its `onStateChange` method returns an unsubscribe function, aligning with other components, and overriding `destroy` to clear listeners. Then, I'll modify the `render` function to return a cleanup function that calls this unsubscribe and destroys the instance. Finally, I'll refactor the test setup to track and call this cleanup after each test to properly unsubscribe and remove DOM elements, ensuring consistent resource management across tests.
```

```
**Updating onStateChange and tests**
```

```
**Adding afterEach import**
```

```
**Preparing final message****Dynamic Cleanup**

- Added teardown support inside `Dynamic.ts` by letting `onStateChange` return an unsubscribe handle, clearing listeners in `destroy`, and making `render` return a cleanup function that removes visualizer subscriptions and destroys the component.
- Updated `dynamic.spec.ts` to import `afterEach`, track the cleanup handle returned from `render`, and remove the mounted DOM node after every test, matching the hover-card pattern.

No tests were executed; consider running `pnpm test dynamic` (or your usual suite) to verify everything end-to-end.

---

