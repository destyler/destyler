<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- vscode Session cb00cb12-65a2-47e0-86ce-0aaac85ceab5 (2025-11-28 02:53Z) -->

# Firefox 测试失败原因分析 (2025-11-28 02:53Z)

_**User (2025-11-28 02:53Z)**_

我有一个小疑问,就是我们的测试在 chromium 的浏览器模式下,可以正常通过,为什么在 firefox 下就会出错,这是为什么

---

_**Agent (model copilot/claude-opus-4.5)**_

这是一个很好的问题！Chromium 和 Firefox 之间的测试差异通常由以下几个原因造成：

## 常见原因

### 1. **浏览器引擎差异**
- Chromium 使用 **Blink** 引擎
- Firefox 使用 **Gecko** 引擎
- 它们在某些 Web API、CSS 特性和 DOM 行为上存在细微差异

### 2. **事件处理差异**
- 事件触发顺序可能不同（如 `focus`、`blur`、`input` 事件）
- 键盘事件的 `keyCode`、`which` 值可能不同
- `compositionstart`/`compositionend` 等输入法事件处理不同

### 3. **异步时序问题**
- 动画帧 (`requestAnimationFrame`) 的时序
- 微任务 (microtask) 和宏任务 (macrotask) 的执行顺序
- 测试中可能需要更多的 `await` 或 `waitFor`

### 4. **CSS 和布局差异**
- `scrollIntoView` 行为
- `getBoundingClientRect` 返回值的精度
- Flexbox/Grid 布局的细微差异

### 5. **浏览器特有 API**
- 剪贴板 API (`navigator.clipboard`)
- 拖放 API
- Selection API

## 建议排查方法

要找出具体原因，我建议：

1. **运行测试并查看具体错误信息**：
```bash
pnpm vitest --project browser --browser.name=firefox
```

2. **查看哪些测试失败**，然后我可以帮你分析具体的测试代码和错误原因。

你想让我帮你运行 Firefox 下的测试来查看具体是哪些测试失败了吗？这样我可以给你更具体的解决方案。

---

_**User (2025-11-28 02:55Z)**_

你可以帮我看看,但是现在不要修改代码,更多的是告诉我为什么

```
 FAIL   browser (firefox)  packages/components/dynamic/test/dynamic.spec.ts > dynamic browser tests > delete + backspace interaction
VitestBrowserElementError: Cannot find element with locator: getByTestId('solid-input')

<body>
  
  


  <div>
    <div
      class="layout"
      data-story="book"
    >
      <main
        class="layout-root"
      >
        
    
        <main>
          
      
          <div
            data-dynamic-example=""
          >
            
        
            <input
              data-dynamic-copy=""
              data-testid="copy-text"
              style="margin-bottom: 1rem;"
            />
            
        
            <div
              data-dynamic-root=""
              data-focus=""
              data-part="root"
              data-scope="dynamic"
              dir="ltr"
              id="dynamic:dynamic:vanilla"
            >
              
          
              <div … />
              
          
              <input … />
              
        
            </div>
            
      
          </div>
          
    
        </main>
        
  
      </main>
      <div
        class="toolbar"
      >
        <nav>
          <button
            data-active=""
            style=""
          >
            Controls
          </button>
          <button>
            Visualizer
          </button>
        </nav>
        <div>
          <div
            data-active=""
            data-content=""
          >
            <div
              class="controls-container"
            >
              <div … />
              <div … />
              <div … />
              <div … />
              <div … />
              <div … />
              <div … />
            </div>
          </div>
          <div
            data-content=""
          >
            <div
              class="viz"
            >
              <pre … />
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <span
    aria-live="assertive"
    data-live-announcer="true"
    id="__live-region__"
    role="alert"
    style="border: 0px; clip: rect(0px, 0px, 0px, 0px); height: 1px; margin: -1px; overflow: hidden; padding: 0px; position: absolute; width: 1px; white-space: nowrap; overflow-wrap: normal;"
  >
    Tag Svelte deleted
  </span>
</body>...

Failure screenshot:
  - packages/components/dynamic/test/__screenshots__/dynamic.spec.ts/dynamic-browser-tests-delete---backspace-interaction-1.png

 ❯ seeTagIsHighlighted packages/components/dynamic/test/dynamic.spec.ts:52:29
 ❯ packages/components/dynamic/test/dynamic.spec.ts:209:11

Caused by: Error: Matcher did not succeed in time.
 ❯ promise callback*seeTagIsHighlighted packages/components/dynamic/test/dynamic.spec.ts:52:29
 ❯ packages/components/dynamic/test/dynamic.spec.ts:209:11

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/19]⎯

 FAIL   browser (firefox)  packages/components/edit/test/edit.spec.ts > edit browser tests > on type and click submit, should commit value
Error: expect(element).toHaveTextContent()

Expected element to have text content:
  World!
Received:
  ld!

Failure screenshot:
  - packages/components/edit/test/__screenshots__/edit.spec.ts/edit-browser-tests-on-type-and-click-submit--should-commit-value-1.png

 ❯ seePreviewHasValue packages/components/edit/test/edit.spec.ts:36:37
     34| 
     35| async function seePreviewHasValue(value: string) {
     36|   return expect.element(previewEl()).toHaveTextContent(value)
       |                                     ^
     37| }
     38| 
 ❯ packages/components/edit/test/edit.spec.ts:101:10

Caused by: Error: Matcher did not succeed in time.
 ❯ promise callback*seePreviewHasValue packages/components/edit/test/edit.spec.ts:35:34
 ❯ packages/components/edit/test/edit.spec.ts:101:10

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/19]⎯

 FAIL   browser (firefox)  packages/components/edit/test/edit.spec.ts > edit browser tests > on type and click outside, should commit value
Error: expect(element).toHaveTextContent()

Expected element to have text content:
  World!
Received:
  orld!

Failure screenshot:
  - packages/components/edit/test/__screenshots__/edit.spec.ts/edit-browser-tests-on-type-and-click-outside--should-commit-value-1.png

 ❯ seePreviewHasValue packages/components/edit/test/edit.spec.ts:36:37
     34| 
     35| async function seePreviewHasValue(value: string) {
     36|   return expect.element(previewEl()).toHaveTextContent(value)
       |                                     ^
     37| }
     38| 
 ❯ packages/components/edit/test/edit.spec.ts:110:10

Caused by: Error: Matcher did not succeed in time.
 ❯ promise callback*seePreviewHasValue packages/components/edit/test/edit.spec.ts:35:34
 ❯ packages/components/edit/test/edit.spec.ts:110:10

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[6/19]⎯

 FAIL   browser (firefox)  packages/components/edit/test/edit.spec.ts > edit browser tests > [maxLength=4] should respect maxLength
Error: expect(element).toHaveValue(Worl)

Expected the element to have value:
  Worl
Received:
  ds

Failure screenshot:
  - packages/components/edit/test/__screenshots__/edit.spec.ts/edit-browser-tests--maxLength-4--should-respect-maxLength-1.png

 ❯ seeInputHasValue packages/components/edit/test/edit.spec.ts:32:53
     30| 
     31| async function seeInputHasValue(value: string) {
     32|   return expect.element(testHook.getInputEl('edit')).toHaveValue(value)
       |                                                     ^
     33| }
     34| 
 ❯ packages/components/edit/test/edit.spec.ts:120:10

Caused by: Error: Matcher did not succeed in time.
 ❯ promise callback*seeInputHasValue packages/components/edit/test/edit.spec.ts:31:32
 ❯ packages/components/edit/test/edit.spec.ts:120:10

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[7/19]⎯

 FAIL   browser (firefox)  packages/components/hover-card/test/hover-card.spec.ts > hover-card browser tests > should remain open after blurring trigger if pointer opens card
VitestBrowserElementError: Cannot find element with locator: locator('[data-part=content]')

<body>
  
  


  <div>
    <div
      class="layout"
      data-story="book"
    >
      <main
        class="layout-root"
      >
        
    
        <div
          data-testid="outside"
        >
          outside
        </div>
        
    
        <main
          data-hover-card-example=""
        >
          
      
          <div
            style="display: flex; gap: 50px;"
          >
            
        
            <span
              data-testid="hover-card-test-click"
            >
              click
            </span>
            
        
            <a
              data-hover-card-trigger=""
              data-part="trigger"
              data-scope="hover-card"
              data-state="closed"
              href="https://twitter.com/elonehoo"
              id="hover-card:hover-card:vanilla:trigger"
              rel="noreferrer"
              target="_blank"
            >
              
          Twitter
        
            </a>
            
        
            <div
              data-part="test-text"
            >
              Test text
            </div>
            
      
          </div>
          
    
        </main>
        
  
      </main>
      <div
        class="toolbar"
      >
        <nav>
          <button
            data-active=""
            style=""
          >
            Controls
          </button>
          <button>
            Visualizer
          </button>
        </nav>
        <div>
          <div
            data-active=""
            data-content=""
          >
            <div
              class="controls-container"
            >
              <div … />
              <div … />
            </div>
          </div>
          <div
            data-content=""
          >
            <div
              class="viz"
            >
              <pre … />
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

Failure screenshot:
  - packages/components/hover-card/test/__screenshots__/hover-card.spec.ts/hover-card-browser-tests-should-remain-open-after-blurring-trigger-if-pointer-opens-card-1.png

 ❯ packages/components/hover-card/test/hover-card.spec.ts:91:38
     89|     await userEvent.hover(trigger)
     90|     await waitForStability()
     91|     await expect.element(contentEl()).toBeVisible()
       |                                      ^
     92| 
     93|     await focusTrigger()

Caused by: Error: Matcher did not succeed in time.
 ❯ promise callback* packages/components/hover-card/test/hover-card.spec.ts:91:38

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[8/19]⎯

 FAIL   browser (firefox)  packages/components/menu/test/menu.spec.ts > menu browser tests > enter selects the highlighted item
Error: expect(element).toHaveAttribute("data-highlighted", "") // element.getAttribute("data-highlighted") === ""

Expected the element to have attribute:
  data-highlighted=""
Received:
  null

Failure screenshot:
  - packages/components/menu/test/__screenshots__/menu.spec.ts/menu-browser-tests-enter-selects-the-highlighted-item-1.png

 ❯ expectItemHighlighted packages/components/menu/test/menu.spec.ts:29:38
     27| 
     28| async function expectItemHighlighted(text: string) {
     29|   await expect.element(getItem(text)).toHaveAttribute('data-highlighted', '')
       |                                      ^
     30| }
     31| 
 ❯ packages/components/menu/test/menu.spec.ts:133:10

Caused by: Error: Matcher did not succeed in time.
 ❯ promise callback*expectItemHighlighted packages/components/menu/test/menu.spec.ts:29:38
 ❯ packages/components/menu/test/menu.spec.ts:133:10

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[9/19]⎯

 FAIL   browser (firefox)  packages/components/otp-input/test/otp-input.spec.ts > otp input browser tests > on paste: should autofill all fields if focused field is not empty
Error: expect(element).toHaveValue(2)

Expected the element to have value:
  2
Received:


Failure screenshot:
  - packages/components/otp-input/test/__screenshots__/otp-input.spec.ts/otp-input-browser-tests-on-paste--should-autofill-all-fields-if-focused-field-is-not-empty-1.png

 ❯ packages/components/otp-input/test/otp-input.spec.ts:100:50
     98| 
     99|     await expect.element(page.locatoring(first)).toHaveValue('1')
    100|     await expect.element(page.locatoring(second)).toHaveValue('2')
       |                                                  ^
    101|     await expect.element(page.locatoring(third)).toHaveValue('3')
    102|     await expect.element(page.locatoring(third)).toHaveFocus()

Caused by: Error: Matcher did not succeed in time.
 ❯ promise callback* packages/components/otp-input/test/otp-input.spec.ts:100:50

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[10/19]⎯

 FAIL   browser (firefox)  packages/components/radio/test/radio.spec.ts > radio browser tests > should be checked when spacebar is pressed while focused
Error: expect(element).toHaveAttribute("data-state", "checked") // element.getAttribute("data-state") === "checked"

Expected the element to have attribute:
  data-state="checked"
Received:
  data-state="unchecked"

Failure screenshot:
  - packages/components/radio/test/__screenshots__/radio.spec.ts/radio-browser-tests-should-be-checked-when-spacebar-is-pressed-while-focused-1.png

 ❯ expectToBeChecked packages/components/radio/test/radio.spec.ts:9:56
      7| 
      8| async function expectToBeChecked(id: string) {
      9|   await expect.element(page.getByTestId(`radio-${id}`)).toHaveAttribute('data-state', …
       |                                                        ^
     10|   await expect.element(page.getByTestId(`control-${id}`)).toHaveAttribute('data-state'…
     11|   await expect.element(page.getByTestId(`label-${id}`)).toHaveAttribute('data-state', …
 ❯ packages/components/radio/test/radio.spec.ts:58:10

Caused by: Error: Matcher did not succeed in time.
 ❯ promise callback*expectToBeChecked packages/components/radio/test/radio.spec.ts:9:56
 ❯ packages/components/radio/test/radio.spec.ts:58:10

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[11/19]⎯

 FAIL   browser (firefox)  packages/components/select/test/select.spec.ts > select browser tests > should highlight on hover
Error: expect(element).toHaveAttribute("data-highlighted", "") // element.getAttribute("data-highlighted") === ""

Expected the element to have attribute:
  data-highlighted=""
Received:
  null

Failure screenshot:
  - packages/components/select/test/__screenshots__/select.spec.ts/select-browser-tests-should-highlight-on-hover-1.png

 ❯ seeItemIsHighlighted packages/components/select/test/select.spec.ts:24:48
 ❯ packages/components/select/test/select.spec.ts:78:11

Caused by: Error: Matcher did not succeed in time.
 ❯ promise callback*seeItemIsHighlighted packages/components/select/test/select.spec.ts:24:48
 ❯ packages/components/select/test/select.spec.ts:78:11

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[12/19]⎯

 FAIL   browser (firefox)  packages/components/select/test/select.spec.ts > select browser tests > should navigate on home/end
Error: expect(element).toHaveAttribute("data-highlighted", "") // element.getAttribute("data-highlighted") === ""

Expected the element to have attribute:
  data-highlighted=""
Received:
  null

Failure screenshot:
  - packages/components/select/test/__screenshots__/select.spec.ts/select-browser-tests-should-navigate-on-home-end-1.png

 ❯ seeItemIsHighlighted packages/components/select/test/select.spec.ts:24:48
 ❯ packages/components/select/test/select.spec.ts:95:11

Caused by: Error: Matcher did not succeed in time.
 ❯ promise callback*seeItemIsHighlighted packages/components/select/test/select.spec.ts:24:48
 ❯ packages/components/select/test/select.spec.ts:95:11

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[13/19]⎯

 FAIL   browser (firefox)  packages/components/select/test/select.spec.ts > select browser tests > should open with down arrow keys + highlight first option
Error: expect(element).toBeVisible()

Received element is not visible:
  <ul
  aria-labelledby="select:select:vanilla:label"
  data-part="content"
  data-scope="select"
  data-select-content=""
  data-state="closed"
  data-testid="select:content"
  dir="ltr"
  hidden=""
  id="select:select:vanilla:content"
  role="listbox"
  tabindex="0"
/>

Failure screenshot:
  - packages/components/select/test/__screenshots__/select.spec.ts/select-browser-tests-should-open-with-down-arrow-keys---highlight-first-option-1.png

 ❯ seeDropdown packages/components/select/test/select.spec.ts:11:55
 ❯ packages/components/select/test/select.spec.ts:160:11

Caused by: Error: Matcher did not succeed in time.
 ❯ promise callback*seeDropdown packages/components/select/test/select.spec.ts:11:55
 ❯ packages/components/select/test/select.spec.ts:160:11

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[14/19]⎯

 FAIL   browser (firefox)  packages/components/signature/test/signature.spec.ts > signature browser tests > draws a stroke and shows the exported preview
AssertionError: expected 0 to be greater than 0

Failure screenshot:
  - packages/components/signature/test/__screenshots__/signature.spec.ts/signature-browser-tests-draws-a-stroke-and-shows-the-exported-preview-1.png

 ❯ drawStroke/< packages/components/signature/test/signature.spec.ts:94:36
 ❯ drawStroke packages/components/signature/test/signature.spec.ts:93:11
 ❯ async* packages/components/signature/test/signature.spec.ts:112:10

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[15/19]⎯

 FAIL   browser (firefox)  packages/components/signature/test/signature.spec.ts > signature browser tests > clears paths, hides preview, and returns focus to the canvas
AssertionError: expected 0 to be greater than 0

Failure screenshot:
  - packages/components/signature/test/__screenshots__/signature.spec.ts/signature-browser-tests-clears-paths--hides-preview--and-returns-focus-to-the-canvas-1.png

 ❯ drawStroke/< packages/components/signature/test/signature.spec.ts:94:36
 ❯ drawStroke packages/components/signature/test/signature.spec.ts:93:11
 ❯ async* packages/components/signature/test/signature.spec.ts:126:10

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[16/19]⎯

 FAIL   browser (firefox)  packages/components/signature/test/signature.spec.ts > signature browser tests > prevents additional strokes after readOnly is enabled
AssertionError: expected 0 to be greater than 0

Failure screenshot:
  - packages/components/signature/test/__screenshots__/signature.spec.ts/signature-browser-tests-prevents-additional-strokes-after-readOnly-is-enabled-1.png

 ❯ drawStroke/< packages/components/signature/test/signature.spec.ts:80:37
 ❯ drawStroke packages/components/signature/test/signature.spec.ts:79:12
 ❯ async* packages/components/signature/test/signature.spec.ts:133:11

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[17/19]⎯

 FAIL   browser (firefox)  packages/components/tabs/test/tabs.spec.ts > [tabs] browser tests > automatic: on arrow right, loop focus + selection
Error: expect(element).toHaveFocus()

Expected element with focus:
  <button
  data-orientation="horizontal"
  data-ownedby="tabs:tabs:vanilla:list"
  data-part="trigger"
  data-scope="tabs"
  data-tabs-trigger="joke"
  data-testid="joke:trigger"
  data-value="joke"
  dir="ltr"
  id="tabs:tabs:vanilla:trigger-joke"
  role="tab"
  tabindex="-1"
  type="button"
>···
        Joke·······
</button>
Received element with focus:
  <button
  aria-controls="tabs:tabs:vanilla:content-agnes"
  aria-selected="true"
  data-orientation="horizontal"
  data-ownedby="tabs:tabs:vanilla:list"
  data-part="trigger"
  data-scope="tabs"
  data-selected=""
  data-tabs-trigger="agnes"
  data-testid="agnes:trigger"
  data-value="agnes"
  dir="ltr"
  id="tabs:tabs:vanilla:trigger-agnes"
  role="tab"
  tabindex="0"
  type="button"
>···
        Agnes Obel·······
</button>

Failure screenshot:
  - packages/components/tabs/test/__screenshots__/tabs.spec.ts/-tabs--browser-tests-automatic--on-arrow-right--loop-focus---selection-1.png

 ❯ seeTabIsFocused packages/components/tabs/test/tabs.spec.ts:14:27
     12| async function seeTabIsFocused(id: string) {
     13|   const el = testHook.getTrigger(id)
     14|   await expect.element(el).toHaveFocus()
       |                           ^
     15| }
     16| 
 ❯ packages/components/tabs/test/tabs.spec.ts:109:10

Caused by: Error: Matcher did not succeed in time.
 ❯ promise callback*seeTabIsFocused packages/components/tabs/test/tabs.spec.ts:14:27
 ❯ packages/components/tabs/test/tabs.spec.ts:109:10

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[18/19]⎯

 FAIL   browser (firefox)  packages/components/tabs/test/tabs.spec.ts > [tabs] browser tests > manual: on arrow right, focus but not select tab
Error: expect(element).toHaveFocus()

Expected element with focus:
  <button
  data-orientation="horizontal"
  data-ownedby="tabs:tabs:vanilla:list"
  data-part="trigger"
  data-scope="tabs"
  data-tabs-trigger="agnes"
  data-testid="agnes:trigger"
  data-value="agnes"
  dir="ltr"
  id="tabs:tabs:vanilla:trigger-agnes"
  role="tab"
  tabindex="-1"
  type="button"
>···
        Agnes Obel·······
</button>
Received element with focus:
  <button
  aria-controls="tabs:tabs:vanilla:content-nils"
  aria-selected="true"
  data-orientation="horizontal"
  data-ownedby="tabs:tabs:vanilla:list"
  data-part="trigger"
  data-scope="tabs"
  data-selected=""
  data-tabs-trigger="nils"
  data-testid="nils:trigger"
  data-value="nils"
  dir="ltr"
  id="tabs:tabs:vanilla:trigger-nils"
  role="tab"
  tabindex="0"
  type="button"
>···
        Nils Frahm·······
</button>

Failure screenshot:
  - packages/components/tabs/test/__screenshots__/tabs.spec.ts/-tabs--browser-tests-manual--on-arrow-right--focus-but-not-select-tab-1.png

 ❯ seeTabIsFocused packages/components/tabs/test/tabs.spec.ts:14:27
     12| async function seeTabIsFocused(id: string) {
     13|   const el = testHook.getTrigger(id)
     14|   await expect.element(el).toHaveFocus()
       |                           ^
     15| }
     16| 
 ❯ packages/components/tabs/test/tabs.spec.ts:127:10

Caused by: Error: Matcher did not succeed in time.
 ❯ promise callback*seeTabIsFocused packages/components/tabs/test/tabs.spec.ts:14:27
 ❯ packages/components/tabs/test/tabs.spec.ts:127:10

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[19/19]⎯

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯ Unhandled Errors ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯

Vitest caught 7 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯ Error ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
InternalError: too much recursion
 ❯ onDismiss packages/components/combobox/src/machine.ts:712:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12
 ❯ onDismiss packages/components/combobox/src/machine.ts:712:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12
 ❯ onDismiss packages/components/combobox/src/machine.ts:712:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12
 ❯ onDismiss packages/components/combobox/src/machine.ts:712:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12
 ❯ onDismiss packages/components/combobox/src/machine.ts:712:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12
 ❯ onDismiss packages/components/combobox/src/machine.ts:712:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12
 ❯ onDismiss packages/components/combobox/src/machine.ts:712:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12
 ❯ onDismiss packages/components/combobox/src/machine.ts:712:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12
 ❯ onDismiss packages/components/combobox/src/machine.ts:712:19

This error originated in "packages/components/combobox/test/combobox.spec.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "escape should close content". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯ Error ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
InternalError: too much recursion
 ❯ onDismiss packages/components/combobox/src/machine.ts:712:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12
 ❯ onDismiss packages/components/combobox/src/machine.ts:712:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12
 ❯ onDismiss packages/components/combobox/src/machine.ts:712:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12
 ❯ onDismiss packages/components/combobox/src/machine.ts:712:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12
 ❯ onDismiss packages/components/combobox/src/machine.ts:712:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12
 ❯ onDismiss packages/components/combobox/src/machine.ts:712:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12
 ❯ onDismiss packages/components/combobox/src/machine.ts:712:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12
 ❯ onDismiss packages/components/combobox/src/machine.ts:712:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12

This error originated in "packages/components/combobox/test/combobox.spec.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "escape should close content". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯ Error ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
NotFoundError: Element.setPointerCapture: Invalid pointer id
 ❯ onPointerDown packages/components/signature/src/connect.ts:80:30
 ❯ firePointerOnControl packages/components/signature/test/signature.spec.ts:61:9
 ❯ performStroke packages/components/signature/test/signature.spec.ts:81:23
 ❯ drawStroke packages/components/signature/test/signature.spec.ts:92:8
 ❯ packages/components/signature/test/signature.spec.ts:112:10

This error originated in "packages/components/signature/test/signature.spec.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "draws a stroke and shows the exported preview". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯ Error ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
NotFoundError: Element.setPointerCapture: Invalid pointer id
 ❯ onPointerDown packages/components/signature/src/connect.ts:80:30
 ❯ firePointerOnControl packages/components/signature/test/signature.spec.ts:61:9
 ❯ performStroke packages/components/signature/test/signature.spec.ts:81:23
 ❯ drawStroke packages/components/signature/test/signature.spec.ts:92:8
 ❯ packages/components/signature/test/signature.spec.ts:126:10

This error originated in "packages/components/signature/test/signature.spec.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "clears paths, hides preview, and returns focus to the canvas". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯ Error ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
NotFoundError: Element.setPointerCapture: Invalid pointer id
 ❯ onPointerDown packages/components/signature/src/connect.ts:80:30
 ❯ firePointerOnControl packages/components/signature/test/signature.spec.ts:61:9
 ❯ performStroke packages/components/signature/test/signature.spec.ts:81:23
 ❯ drawStroke packages/components/signature/test/signature.spec.ts:92:8
 ❯ packages/components/signature/test/signature.spec.ts:164:10

This error originated in "packages/components/signature/test/signature.spec.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "prevents additional strokes after readOnly is enabled". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯ Error ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
InternalError: too much recursion
 ❯ onDismiss packages/components/combobox/src/machine.ts:691:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12
 ❯ onDismiss packages/components/combobox/src/machine.ts:691:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12
 ❯ onDismiss packages/components/combobox/src/machine.ts:691:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12
 ❯ onDismiss packages/components/combobox/src/machine.ts:691:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12
 ❯ onDismiss packages/components/combobox/src/machine.ts:691:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12
 ❯ onDismiss packages/components/combobox/src/machine.ts:691:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12
 ❯ onDismiss packages/components/combobox/src/machine.ts:691:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12
 ❯ onDismiss packages/components/combobox/src/machine.ts:691:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12
 ❯ onDismiss packages/components/combobox/src/machine.ts:691:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85

This error originated in "packages/components/combobox/test/combobox.spec.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "keyboard / arrowup / no-loop". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯ Error ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
InternalError: too much recursion
 ❯ onDismiss packages/components/combobox/src/machine.ts:691:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12
 ❯ onDismiss packages/components/combobox/src/machine.ts:691:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12
 ❯ onDismiss packages/components/combobox/src/machine.ts:691:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12
 ❯ onDismiss packages/components/combobox/src/machine.ts:691:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12
 ❯ onDismiss packages/components/combobox/src/machine.ts:691:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12
 ❯ onDismiss packages/components/combobox/src/machine.ts:691:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12
 ❯ onDismiss packages/components/combobox/src/machine.ts:691:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12
 ❯ onDismiss packages/components/combobox/src/machine.ts:691:19
 ❯ remove/< packages/shareds/dismissable/dist/index.mjs:57:85
 ❯ remove packages/shareds/dismissable/dist/index.mjs:57:60
 ❯ trackDismissableElementImpl/< packages/shareds/dismissable/dist/index.mjs:171:14
 ❯ trackDismissableElement/</< packages/shareds/dismissable/dist/index.mjs:186:28
 ❯ trackDismissableElement/< packages/shareds/dismissable/dist/index.mjs:186:12

This error originated in "packages/components/combobox/test/combobox.spec.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "selects value on click". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯


 Test Files  10 failed | 131 passed (141)
      Tests  19 failed | 1468 passed (1487)
     Errors  7 errors
   Start at  10:52:09
   Duration  105.66s (transform 4.76s, setup 797ms, import 10.79s, tests 557.32s, environment 3ms)

 FAIL  Tests failed. Watching for file changes...
       press h to show help, press q to quit
```

---

_**Agent (model copilot/claude-opus-4.5)**_

感谢你提供这些详细的错误信息！让我来分析这些在 Firefox 下失败的测试，并解释原因：

## 测试失败原因分析

根据错误日志，我把问题分为几个主要类别：

---

### 1. **键盘事件处理差异** (Tabs, Radio, Select, Menu)

**失败的测试：**
- `tabs.spec.ts` - Arrow key navigation
- `radio.spec.ts` - Spacebar selection
- `select.spec.ts` - Arrow keys, Home/End
- `menu.spec.ts` - Enter selection

**原因：**
Firefox 和 Chromium 在处理键盘事件时有以下差异：
- **焦点管理**：Firefox 对 `tabindex` 和焦点切换的处理更严格
- **键盘事件传播**：`keydown` 事件的 `preventDefault()` 行为可能不同
- **ArrowRight/ArrowLeft** 在 Firefox 中可能需要显式的焦点移动代码

从错误信息看，按下方向键后焦点没有移动到预期的元素：
```
Expected element with focus: <button data-tabs-trigger="joke">
Received element with focus: <button data-tabs-trigger="agnes">  // 焦点没移动
```

---

### 2. **Hover 事件差异** (HoverCard, Select)

**失败的测试：**
- `hover-card.spec.ts` - Hover to open
- `select.spec.ts` - Highlight on hover

**原因：**
- Firefox 对 `mouseenter`/`mouseover` 事件的触发时机与 Chromium 不同
- **Playwright 的 `userEvent.hover()`** 在 Firefox 中可能无法正确模拟真实的鼠标悬停
- 悬停状态的 `data-highlighted` 属性没有被设置

---

### 3. **输入事件/剪贴板差异** (Edit, OTP-Input)

**失败的测试：**
- `edit.spec.ts` - 输入值被截断 (`World!` → `ld!`)
- `otp-input.spec.ts` - 粘贴后值为空

**原因：**
- **输入事件序列**：Firefox 的 `input`、`change`、`compositionend` 事件顺序不同
- **剪贴板 API**：Firefox 对 `navigator.clipboard` 有更严格的权限要求
- **光标位置**：Firefox 在 `select()` 后光标位置可能不同

错误显示输入被部分丢失：
```
Expected: World!
Received: ld!      // 前面的字符丢失了
```

---

### 4. **Pointer Events 差异** (Signature)

**失败的测试：**
- `signature.spec.ts` - 绘制笔划失败

**原因（这是最明确的）：**
```
NotFoundError: Element.setPointerCapture: Invalid pointer id
```

Firefox 对 **Pointer Capture API** 要求更严格：
- `setPointerCapture()` 必须使用真实的 `pointerId`
- 测试中模拟的 `PointerEvent` 可能没有有效的 `pointerId`
- Chromium 对无效的 `pointerId` 更宽容

---

### 5. **事件处理递归** (Combobox) - **最严重的问题**

**错误：**
```
InternalError: too much recursion
❯ onDismiss packages/components/combobox/src/machine.ts:712:19
❯ trackDismissableElement ...
```

**原因：**
这是一个 **真正的 bug**，而不只是浏览器差异！

`dismissable` 模块在 Firefox 中触发了无限递归：
- `onDismiss` 被调用
- `onDismiss` 内部又触发了 dismiss 事件
- 形成死循环

Firefox 的调用栈限制比 Chromium 更严格，所以先触发了 `too much recursion` 错误。这个问题在 Chromium 中可能也存在，只是没有立即崩溃。

---

### 6. **DOM 元素未渲染** (Dynamic)

**失败的测试：**
```
Cannot find element with locator: getByTestId('solid-input')
```

**原因：**
- 异步渲染时序问题
- Firefox 的渲染引擎可能比 Chromium 慢
- 需要更多的 `waitFor` 或 `waitForStability`

---

## 总结

| 问题类型 | 受影响组件 | 根本原因 |
|---------|-----------|---------|
| 键盘事件 | Tabs, Radio, Select, Menu | Firefox 对焦点/键盘事件处理更严格 |
| Hover 事件 | HoverCard, Select | Firefox 鼠标事件触发时机不同 |
| 输入事件 | Edit, OTP-Input | 输入事件序列、剪贴板权限差异 |
| Pointer API | Signature | `setPointerCapture` 需要有效的 pointerId |
| 事件递归 | Combobox | **代码 bug** - `onDismiss` 无限递归 |
| 渲染时序 | Dynamic | 需要更多等待时间 |

**最需要关注的是 Combobox 的递归问题**，这是一个实际的代码缺陷，应该修复。其他问题主要是测试代码需要适配 Firefox 的行为差异。

---

