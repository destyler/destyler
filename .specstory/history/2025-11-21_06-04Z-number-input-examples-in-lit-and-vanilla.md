<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- vscode Session 34574d61-ebc6-4480-a0de-e4e1fe366348 (2025-11-21 06:04Z) -->

# Number Input Examples in Lit and Vanilla (2025-11-21 06:04Z)

_**User (2025-11-21 06:10Z)**_

我想你根据 #packages/components/combobox 和 #packages/components/color-picker 的 lit 和 vanilla 的 example 来帮我编写一下 #packages/components/number-input 的 examples 中的 lit 和 vanilla 的例子.你可以看看 #packages/components/number-input 中的 [react](packages/components/number-input/examples/react/NumberInput.react.tsx) 和 [solid](packages/components/number-input/examples/solid/NumberInput.solid.tsx), [vue](packages/components/number-input/examples/vue/NumberInput.vue), [svelte](packages/components/number-input/examples/svelte/NumberInput.svelte) ,同时别忘了在 storybook 中注册哦

---

_**Agent (model copilot/gpt-5.1-codex)**_

**Preparing a task list****Starting task 1****Inspecting directory structure****Listing example file paths****Opening file****Checking vanilla combobox example****Gathering color-picker examples****Seeking vanilla color picker****Marking first todo as complete****Inspecting number input structure****Checking examples directory****Evaluating framework directories and styles****Identifying need for Solid framework****Searching for Vue example****Identifying framework requirement****Checking style files****Planning number-input examples structure****Considering vanilla Astro example****Outlining number-input component setup****Checking types.ts for exports****Checking type imports and generics****Preparing component examples****Exploring story entries in components****Checking example story files****Checking vanilla story****Preparing number-input storybook setup**

I'll create new example directories for number-input in both lit and vanilla styles, then figure out the proper base classes and generics for the vanilla component by examining similar existing components like checkbox and color-picker, so I can implement NumberInput correctly and ensure it's registered in the storybook.**Designing number input component and examples**

I'm gathering all the details to create both vanilla and lit examples for the number input component, matching test attributes and DOM structure from React. I’m mapping out types, state handling, rendering logic, and control integration while planning file paths and directory creation for clean implementation.**Creating lit.astro file****Creating lit test file****Preparing for vanilla file creation****Drafting NumberInput component in TypeScript**

I'm preparing to create the `NumberInput.ts` file by carefully translating the React-like API usage into a vanilla TypeScript component. I'll manage label text manually, ensure the `data-testid` attributes stay intact despite `spreadProps` usage, and handle state updates and value syncing based on the machine and API. This component will focus on preserving accessibility and interactive behavior while matching the React example patterns.**Clarifying subscription return types**

I’m sorting out type conflicts around the subscribe method, which should return a cleanup function `() => void` according to `ContextSource` interface but currently seems to return `void`. To fix this, I’m verifying if `controls.subscribe` really returns a function or not, and considering wrapping the call to always return a function to satisfy TypeScript’s expectations. I’m also checking related examples and source code to confirm the true behavior.**Correcting parameter name****Simplifying type usage**
```

```
**Verifying type and todo updates****Updating task status****Marking id3 as in-progress****Marking id3 as completed****Preparing to add storybook entries****Preparing to create new example files****Planning status updates****Checking for linting and git status****Preparing final update summary****Number Input Examples**
- Added a Lit demo (`NumberInput.ts` + `.astro`) that wires the machine through `MachineController`, renders the scrubber/control/label structure with `spread(...)`, pipes control-panel context via `ControlsController`, and feeds the state visualizer with `omit={['formatter','parser']}`.
- Implemented a Vanilla demo (`NumberInput.ts` + `.astro`) using the shared `Component` base: queries each DOM hook, applies `spreadProps(...)`, keeps label text in sync, and mirrors the toolbar/controls/state-visualizer setup used in other frameworks.
- Registered both demos in Storybook via `lit.stories.ts` and `vanilla.stories.ts`, pointing to the new Astro entry points.

- Tests: not run (not requested).

Next steps: 1) Run `pnpm storybook` (or the project’s Storybook workflow) to visually verify the new Lit/Vanilla stories. 2) If needed, hook the docs build so the Astro examples show up alongside the other frameworks.

---

_**User (2025-11-21 06:16Z)**_

我们又出现了那个问题,我们的 input 框 在 vanilla 中被加上了 readonly 导致无法使用 input

---

_**Agent (model copilot/gpt-5.1-codex)**_

**Investigating readOnly issue on NumberInput****Investigating input readonly behavior****Considering search location****Checking shared controls definition****Investigating readOnly attribute origin****Reviewing readOnly property in machine context****Analyzing default readOnly behavior****Searching in workspace****Searching for file location****Searching for packages/vanilla directory****Checking for vanilla framework package****Locating specific source directory****Opening component****Checking subscribe return type****Searching for file in shared-private****Identifying required module****Investigating subscribe return type and readOnly property****Investigating unexpected readonly attribute****Analyzing context merging and readOnly state****Investigating readonly attribute issue****Searching for `.removeAttribute('readonly')`****Investigating input readonly behavior****Investigating unexpected readOnly attribute****Analyzing readOnly attribute normalization****Analyzing readOnly attribute handling**

I'm untangling why the `readonly` attribute toggles unexpectedly—considering how `spreadProps`, `normalizeProps`, and `setContext` might mishandle `readOnly` being undefined or missing. There’s a complex interaction with partial context merges and boolean attribute logic that might cause the input to become stuck read-only, so I’m thinking about inspecting DOM or deeper setContext behavior to pinpoint the root cause.**Checking for machine.ts file****Opening machine file section****Analyzing readonly attribute bug****Considering package placement****Investigating readonly input issue****Analyzing readonly attribute bug**

I’m tracing why the `'readonly'` attribute shows as present with value `"false"`, which still disables input despite our removing it. It seems the bug arises because `normalizeProps` lowercases `'readOnly'` to `'readonly'`, but DOM properties are case-sensitive, so setting `element['readonly'] = false` fails and falls back to setting the attribute to `'false'`, which keeps the input readonly. I’ll fix this by mapping `'readonly'` to `'readOnly'` when setting properties in `setProperty`, ensuring correct property assignment without incorrect attribute re-adding.
```

```
**Preparing to respond and verify changes****Summarizing fix and next steps****Vanilla Input Fix**
- Found the culprit in `spread-props.ts`: when boolean attributes are removed, we still called `setProperty` with the lowercased key. For `readonly`, this meant `setAttribute('readonly', 'false')`, so the attribute stayed present and the field was effectively read-only.
- Added a small `propertyNameMap` so that `readonly` is written via the actual DOM property `readOnly`. Now clearing the flag truly removes the attribute and the number input is editable again.

No automated tests were run (not requested). If you have other camelCase-only props that show similar behavior, we can extend the map the same way.

---

_**User (2025-11-21 06:17Z)**_

我们应该修改 connect.ts 让我们的 readonly 只有在 true 的时候才出现

---

_**Agent (model copilot/gpt-5.1-codex)**_

**Adjusting getInputProps for readOnly**
```

```
- Updated `connect.ts` so `getInputProps()` only emits `readOnly` when it’s actually `true` (`false` now becomes `undefined`, preventing the attribute from appearing).  
- Combined with the earlier vanilla spread fix, the input won’t get stuck in read-only anymore.

---

